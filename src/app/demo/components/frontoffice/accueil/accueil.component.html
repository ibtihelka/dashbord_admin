<div class="page-container">
  <div class="page-content">
    
    <!-- Cercle 1 - Bulletins -->
    <div class="circular-btn-wrapper bulletins-btn">
      <button class="circular-btn" (click)="goToRemboursements()">
        <img src="/assets/layout/images/bulletins-icon.png" alt="Bulletins" class="circular-icon">
      </button>
      <span class="circle-title">Mes Bulletins</span>
  
    </div>
    
    <!-- Cercle 2 - Réclamations -->
   <!-- Cercle 2 - Réclamations -->
<div class="circular-btn-wrapper reclamations-btn">
  <button class="circular-btn" (click)="goToReclamations()">
    <img src="/assets/layout/images/reclamation-icon.png" alt="Réclamations" class="circular-icon larger-icon">
  </button>
  <span class="circle-title">Mes Réclamations</span>

</div>

    <!-- Cercle 3 - Modifier Téléphone -->
    <div class="circular-btn-wrapper tel-btn">
      <button class="circular-btn" (click)="goToTel()">
        <img src="/assets/layout/images/modifier_tel.png" alt="Modifier Tel" class="circular-icon">
      </button>
      <span class="circle-title">Modifier Téléphone</span>
     
    </div>

    <!-- Cercle 4 - Modifier RIB -->
    <div class="circular-btn-wrapper rib-btn">
      <button class="circular-btn" (click)="goToRib()">
        <img src="/assets/layout/images/modifier_rib.png" alt="Modifier RIB" class="circular-icon">
      </button>
      <span class="circle-title">Modifier RIB</span>
    
    </div>

    <!-- Cercle 5 - Complément d'Information -->
    <div class="circular-btn-wrapper complement-btn">
      <button class="circular-btn" (click)="goToComplementInfo()">
        <img src="/assets/layout/images/complement_info.png" alt="Complément Info" class="circular-icon">
      </button>
      <span class="circle-title">Complément Info</span>
     
    </div>

    <!-- Cercle 6 - Prestataires de Service -->
    <div class="circular-btn-wrapper prestataires-btn">
      <button class="circular-btn" >
        <img src="/assets/layout/images/prestataire.png" alt="Prestataires" class="circular-icon">
      </button>
      <span class="circle-title">Vos Prestataires</span>
      
    </div>

    <!-- Contenu principal -->
    <div class="bulletin-container">
      <div class="bulletin-card">
        <!-- En-tête avec logos -->
        <div class="bulletin-header">
          <div class="logo-section">
            <div class="logo-left">
              <img src="/assets/layout/images/logo_bh_fr.PNG" alt="BH Assurance" class="logo-img">
              <div class="coordonnees">
                <p class="coord-line">Tel: (216) 71 123 456</p>
                <p class="coord-line">Adresse: Avenue Habib Bourguiba, Tunis</p>
                <p class="coord-line">Email: contact@bhassurance.tn</p>
              </div>
            </div>
            <div class="logo-center">
  <a href="https://bh-assurance.com/" target="_blank" rel="noopener noreferrer" class="logo-link">
    <img src="/assets/layout/images/logo_ph.PNG" alt="Logo Principal" class="logo-img-center">
  </a>
</div>
            <div class="logo-right">
              <img src="/assets/layout/images/logo_bh_arb.PNG" alt="BH تأمين" class="logo-img">
              <div class="coordonnees-rt" dir="rtl">
                <p class="coord-line">هاتف: 456 123 71 (216)</p>
                <p class="coord-line">العنوان: شارع الحبيب بورقيبة، تونس</p>
                <p class="coord-line">البريد الإلكتروني: contact@bhassurance.tn</p>
              </div>
            </div>
          </div>
          <button 
    type="button"
    class="download-bs-btn-header"
    (click)="downloadBSVierge()"
    title="Télécharger un bulletin vierge">
    <i class="pi pi-download"></i>
    
  </button>
 
        </div>
        

        <div class="separator-line"></div>

        <!-- Titre Bulletin de Soins -->
        <div class="bulletin-title-section">
  <div class="bulletin-number-left">
  <label class="numero-label">N°</label>
  
  <!-- Dropdown avec recherche/saisie manuelle -->
  <p-dropdown 
    [options]="bulletinOptions" 
    [(ngModel)]="selectedBulletin"
    optionLabel="label" 
    optionValue="value"
    placeholder="Saisir ou sélectionner"
    [showClear]="true"
    [filter]="true"
    [editable]="true"
    filterBy="label,value"
    styleClass="bulletin-dropdown"
    (onChange)="onBulletinChange($event)"
    (onFilter)="onFilterBulletin($event)">
  </p-dropdown>

  <!-- Bouton de réinitialisation -->
 
</div>


  <div class="title-box">
    <h1 class="bulletin-title">BULLETIN DE SOINS</h1>
    <h2 class="bulletin-title-ar">بطاقـة معالجة</h2>
  </div>
  
  <div class="bulletin-number-right"></div>
</div>



        <!-- Informations Contractant -->
        <div class="info-section">
          <div class="info-row">
            <label class="info-label">Contractant (c) (Cachet)</label>
            <label class="info-label-ar">المؤسسة المؤمّنة (ختم وإمضاء)</label>
          </div>
          <div class="info-value company-name">
            <strong>{{ getCompanyName() }}</strong>
          </div>
        </div>

        <div class="info-section">
          <div class="info-row">
            <label class="info-label">CONTRAT N°</label>
            <label class="info-label-ar">رقم العقد</label>
          </div>
         <div class="info-value">
     <strong>{{ numContrat }}</strong>
   </div>
        </div>

        <div class="info-section">
          <div class="info-row">
            <label class="info-label">ADHERENT N°</label>
            <label class="info-label-ar">رقم المنخرط</label>
          </div>
          <div class="info-input-line"></div>
        </div>

        <!-- Partie à remplir par l'adhérent -->
        <div class="adherent-section">
          <div class="section-title">
            PARTIE À REMPLIR PAR L'ADHÉRENT
          </div>

          <div class="info-section">
            <div class="info-row">
              <label class="info-label">Nom et Prénom de l'Adhérent :</label>
              <label class="info-label-ar">إسم ولقب المنخرط</label>
            </div>
            <div class="info-value">
              <strong>{{ getUserDisplayName() }}</strong>
            </div>
          </div>

          <div class="info-section">
            <div class="info-row">
              <label class="info-label">Adresse :</label>
              <label class="info-label-ar">العنوان</label>
            </div>
            <div class="info-value">
              <strong>{{ getUserAddress() }}</strong>
            </div>
          </div>

          <!-- Prestataire checkboxes avec logique interactive -->
          <div class="checkbox-section">
            <!-- Prestataire : affiche tous les conjoints et enfants -->
            <div>
              <label 
                class="checkbox-label" 
                [class.clickable]="hasPrestataires()"
                [class.disabled]="!hasPrestataires()"
                (click)="hasPrestataires() && onPrestataireClick()">
                <span>Prestataire:</span>
              </label>
            </div>

            <!-- Adhérent : redirige vers le profil -->
            <div class="checkbox-group">
              <label 
                class="checkbox-label clickable" 
                (click)="onAdherentClick()"
                   [title]="hasConjoint() ? 'Afficher mon profil' : ''"
    >
                
                <span>Adhérent</span>
                <input 
                  type="checkbox" 
                  class="checkbox-input"
                  [checked]="selectedType === 'ADHERENT'"
                  (click)="$event.stopPropagation()">
                <span class="checkbox-ar">المنخرط</span>
              </label>
            </div>

            <!-- Conjoint : affiche uniquement le conjoint -->
            <div class="checkbox-group">
              <label 
                class="checkbox-label" 
                [class.clickable]="hasConjoint()"
                [class.disabled]="!hasConjoint()"
                   [title]="hasConjoint() ? 'Afficher le conjoint' : ''"
    
                (click)="hasConjoint() && onConjointClick()">
                <span>Conjoint</span>
                <input 
                  type="checkbox" 
                  class="checkbox-input"
                  [checked]="selectedType === 'CONJOINT'"
                  [disabled]="!hasConjoint()"
                  (click)="$event.stopPropagation()">
                <span class="checkbox-ar">الزوج</span>
              </label>
            </div>

            <!-- Enfant : affiche uniquement les enfants -->
            <div class="checkbox-group">
              <label 
                class="checkbox-label" 
                [class.clickable]="hasEnfants()"
                [class.disabled]="!hasEnfants()"
                 [title]="hasEnfants() ? 'Afficher la liste des enfants' : ''"
    
                (click)="hasEnfants() && onEnfantClick()">
                <span>Enfant</span>
                <input 
                  type="checkbox" 
                  class="checkbox-input"
                  [checked]="selectedType === 'ENFANT'"
                  [disabled]="!hasEnfants()"
                  (click)="$event.stopPropagation()">
                <span class="checkbox-ar">الأبناء</span>
              </label>
            </div>
          </div>

         <!-- Affichage des informations du bénéficiaire -->
<div class="beneficiaire-info" *ngIf="beneficiaireSelected">
 
  <div class="info-row">
    <span class="info-label">Bénéficiaire :</span>
    <span class="info-value">{{ beneficiaireSelected }}</span>
  </div>

</div>

<!-- Date -->
<div class="date-section">
  <div class="date-field">
    <label>A</label>
    <div class="date-line"></div>
    <label>Le</label>
    <div class="date-value-wrapper">
      <strong class="date-value">{{ dateSoinSelected }}</strong>
      <div class="date-underline" *ngIf="!dateSoinSelected"></div>
    </div>
  </div>
</div>

          <!-- Signature -->
          <div class="signature-section">
            <div class="signature-box">
              <label class="signature-label">Signature de l'Adhérent</label>
              <label class="signature-label-ar">إمضاء المنخرط</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Composant pour afficher la liste des prestataires -->
<app-prestataire-list></app-prestataire-list>

<app-client-footer></app-client-footer>
<style>
  .bulletin-dropdown {
    min-width: 200px;
  }
  
  .bulletin-dropdown input {
    text-transform: uppercase;
  }

  .beneficiaire-info {
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #007bff;
  }

  .info-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .info-row:last-child {
    margin-bottom: 0;
  }

  .info-label {
    font-weight: 600;
    color: #495057;
    min-width: 120px;
  }

  .info-value {
    color: #212529;
  }

  .type-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
  }

  .type-adherent {
    background-color: #d1ecf1;
    color: #0c5460;
  }

  .type-conjoint {
    background-color: #d4edda;
    color: #155724;
  }

  .type-enfant {
    background-color: #fff3cd;
    color: #856404;
  }

  .type-prestataire {
    background-color: #e2e3e5;
    color: #383d41;
  }
</style>